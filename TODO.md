# stz 开发计划 (TODO)

## ✅ 已完成功能

- [x] **构建系统**: Zig build system (build.zig) 配置完成
- [x] **X11 窗口**: 基本 X11 窗口创建和事件循环
- [x] **PTY**: 伪终端创建、Fork、Exec 和 I/O 重定向
- [x] **ANSI 解析**: 状态机解析 VT100/VT220 转义序列
- [x] **Xft 渲染**: 使用 FreeType/Xft 进行字体渲染 (支持 UTF-8)
- [x] **双缓冲**: 使用 X11 Pixmap 防止闪烁
- [x] **基本输入**: 键盘字符输入和简单控制键映射

## 🚧 进行中 / 待修复

- [ ] **键盘输入完善**: 
    - [ ] 完整的功能键映射 (F1-F12, Home, End, PageUp, PageDown)
    - [ ] 组合键支持 (Ctrl/Alt/Shift + Key)
    - [ ] Keypad 模式支持
- [ ] **渲染优化**:
    - [ ] 脏矩形优化 (目前全屏重绘)
    - [ ] 粗体/斜体/下划线样式渲染
    - [ ] 宽字符 (CJK) 渲染对其问题修复
- [ ] **剪贴板**:
    - [ ] X11 Selection (PRIMARY/CLIPBOARD) 支持
    - [ ] 鼠标选中文本
    - [ ] 粘贴功能
- [ ] **配置重载**: 支持运行时重载配置 (颜色、字体)

## 📋 待办事项 (Backlog)

### 核心功能
- [ ] **滚动缓冲区 (Scrollback)**: 支持 Shift+PgUp/PgDn 查看历史输出
- [ ] **鼠标支持**: 
    - [ ] 鼠标点击报告 (SGR pixel mode)
    - [ ] 鼠标滚轮滚动
- [ ] **Resize 处理**: 
    - [ ] 完善 SIGWINCH 信号处理
    - [ ] 优化 resize 时的重绘逻辑

### 高级特性
- [ ] **Box Drawing**: 优化的框线字符绘制 (不依赖字体)
- [ ] **URL 检测**: 自动检测 URL 并支持点击打开
- [ ] **TrueColor**: 确认 24 位真彩色支持的完整性
- [ ] **透明度**: X11 Alpha 通道支持

### 代码质量
- [ ] **测试**: 增加单元测试覆盖率 (Parser, Screen)
- [ ] **文档**: 完善模块文档注释
- [ ] **错误处理**: 更优雅的错误恢复机制

## 已知问题

1. **输入残留**: 目前键盘输入映射尚不完整，特殊键可能无法工作。
2. **性能**: 全屏重绘导致性能开销较大。
3. **残留图像**: 窗口移动/遮挡后可能偶尔出现残留 (Expose 事件处理需优化)。
